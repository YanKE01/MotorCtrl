C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/01/2023 22:13:45 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE FU68XX_2_SYSTEM
OBJECT MODULE PLACED IN .\Output\FU68xx_2_System.obj
COMPILER INVOKED BY: D:\IDE\keil\C51\BIN\C51.EXE ..\FU68xx_Hardware_Driver\Source\FU68xx_2_System.c LARGE OMF2 WARNINGLE
                    -VEL(0) BROWSE INCDIR(..\User\Include;..\FU68xx_Hardware_Driver\Include) DEBUG PRINT(.\Listing\FU68xx_2_System.lst) TABS(
                    -2) OBJECT(.\Output\FU68xx_2_System.obj)

line level    source

   1          /**
   2           * @copyright (C) COPYRIGHT 2022 Fortiortech Shenzhen
   3           * @file      FU68xx_2_System.c
   4           * @author    Fortiortech  Appliction Team
   5           * @since     Create:2021-05-14
   6           * @date      Last modify:2022-07-14
   7           * @brief     This file contains system function used for Motor Control.
   8           */
   9          #include <FU68xx_2.h>
  10          #include <Myproject.h>
  11          
  12          /** 
  13           * @brief        å‚è€ƒç”µå‹é…ç½®
  14           */
  15          void VREFConfig(uint8 Status)
  16          {
  17   1          #if (HW_ADC_VREF==VREF3_0)
                  {
                      SetBit(VREF_VHALF_CR, VRVSEL1);             //00-->4.5V   01-->VDD5
                      ClrBit(VREF_VHALF_CR, VRVSEL0);             //10-->3.0V   11-->4.0V
                  }
                  #elif (HW_ADC_VREF==VREF4_0)
                  {
                      SetBit(VREF_VHALF_CR, VRVSEL1);             //00-->4.5V   01-->VDD5
                      SetBit(VREF_VHALF_CR, VRVSEL0);             //10-->3.0V   11-->4.0V
                  }
                  #elif (HW_ADC_VREF==VREF4_5)
  28   1          {
  29   2              ClrBit(VREF_VHALF_CR, VRVSEL1);             //00-->4.5V   01-->VDD5
  30   2              ClrBit(VREF_VHALF_CR, VRVSEL0);             //10-->3.0V   11-->4.0V
  31   2          }
  32   1          #else
                  {
                      ClrBit(VREF_VHALF_CR, VRVSEL1);             //00-->4.5V   01-->VDD5
                      SetBit(VREF_VHALF_CR, VRVSEL0);             //10-->3.0V   11-->4.0V
                  }
                  #endif
  38   1      
  39   1          SetReg(VREF_VHALF_CR, VREFEN, (Status ? VREFEN : 0x00));
  40   1      }
  41          
  42          
  43          /** 
  44           * @brief        åŸºå‡†ç”µå‹VHALFé…ç½®
  45           */
  46          void VHALFConfig(uint8 Status)
  47          {
  48   1          SetReg(VREF_VHALF_CR, VHALFEN, (Status ? VHALFEN : 0x00));
  49   1      }
  50          
  51          /** 
  52           * @brief        çœ‹é—¨ç‹—é…ç½®
  53           * @param[in]    Value : [è¾“å…¥] -- å®šæ—¶æ—¶é—´ï¼Œå•ä½msï¼Œæœ€å°å®šæ—¶æ—¶é—´8msï¼Œæœ€å¤§å®šæ—¶1800ms
C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/01/2023 22:13:45 PAGE 2   

  54           * @param[in]    Status: [è¾“å…¥] -- ä½¿èƒ½æ§åˆ¶ï¼ŒDisableæˆ–Enable
  55           */
  56          /* -------------------------------------------------------------------------------------------------
  57              Function Name  : WatchDogConfig
  58              Description    : 1ã€çœ‹é—¨ç‹—å®šæ—¶å‡½æ•°åˆå§‹åŒ–ï¼Œçœ‹é—¨ç‹—ä½¿èƒ½å’Œå¤ä½ä½¿èƒ½ï¼Œå®šæ—¶é…ç½®
  59              Date           : 2020-08-07
  60              Parameter      : Value : [è¾“å…¥] -- å®šæ—¶æ—¶é—´ï¼Œå•ä½msï¼Œæœ€å°å®šæ—¶æ—¶é—´8msï¼Œæœ€å¤§å®šæ—¶180
             -0ms
  61          **               Status: [è¾“å…¥] -- ä½¿èƒ½æ§åˆ¶ï¼ŒDisableæˆ–Enable
  62          ------------------------------------------------------------------------------------------------- */
  63          void WatchDogConfig(uint16 Value, uint8 Status)
  64          {
  65   1          SetReg(CCFG1, WDTEN, (Status ? WDTEN : 0x00));
  66   1          WDT_REL = ((uint16)(65532-(uint32)Value*32768/1000) >> 8);
  67   1          ClrBit(WDT_CR, WDTF);
  68   1          SetBit(WDT_CR, WDTRF);
  69   1      }
  70          
  71          
  72          /** 
  73           * @brief        åˆ·æ–°çœ‹é—¨ç‹—è®¡æ•°å™¨
  74           */
  75          void WatchDogRefresh(void)
  76          {
  77   1          SetBit(WDT_CR, WDTRF);
  78   1      }
  79          
  80          
  81          /** 
  82           * @brief        1ã€æ‰‡åŒºè‡ªæ“¦é™¤: æŒ‡å®šå°†è¦æ“¦é™¤çš„Flashæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒº128Byteï¼Œå…±128ä¸ªæ‰
             -‡åŒº
  83                           2ã€æ‰‡åŒº0~127å¯¹åº”Flashåœ°å€0x0000~0x3fffï¼Œé€šè¿‡æŒ‡å®šFlashåœ°å€æ¥æŒ‡å®šè¦æ“¦é™¤
  84                           3ã€çš„Flashåœ°å€æ‰€åœ¨æ‰‡åŒºã€‚ä¸€æ¬¡åªèƒ½æ“¦é™¤ä¸€ä¸ªæ‰‡åŒºï¼Œè‡ªæ“¦é™¤æ•°æ®ä¸ºä»»æ„
             -å€¼ï¼Œä¸€å®š
  85                           4ã€è¦åœ¨è§£é”åæ‰ç»™DPTRèµ‹å€¼ã€‚
  86           * @param[in]    FlashAddress: [è¾“å…¥] -Flashè‡ªæ“¦é™¤æ‰‡åŒºå†…ä»»æ„åœ°å€
  87           * @return        [è¾“å‡º] 0--Flashè‡ªæ“¦é™¤æˆåŠŸï¼Œ1--Flashè‡ªæ“¦é™¤å¤±è´¥
  88           */
  89          uint8 Flash_Sector_Erase(uint8 xdata *FlashAddress)
  90          {
  91   1          bool TempEA;
  92   1          uint16 TempFlashAddress;
  93   1      
  94   1          TempEA = EA;
  95   1          EA = 0;
  96   1          TempFlashAddress = FlashAddress;
  97   1      
  98   1          if(TempFlashAddress < 0x3f80)                   // ä¸æ“¦é™¤æœ€åä¸€ä¸ªæ‰‡åŒº
  99   1          {
 100   2              FLA_CR = 0x03;                          //ä½¿èƒ½è‡ªæ“¦é™¤
 101   2              FLA_KEY = 0x5a;
 102   2              FLA_KEY = 0x1f;                         //flashé¢„ç¼–ç¨‹è§£é”
 103   2              _nop_();
 104   2              *FlashAddress = 0xff;                   //å†™ä»»æ„æ•°æ®
 105   2              FLA_CR = 0x08;                          //å¼€å§‹é¢„ç¼–ç¨‹ï¼Œå®ŒæˆåFlashå†æ¬¡ä¸Šé”
 106   2          }
 107   1      
 108   1          EA = TempEA;
 109   1      
 110   1          if(ReadBit(FLA_CR, FLAERR))
 111   1          {
 112   2              return 1;
C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/01/2023 22:13:45 PAGE 3   

 113   2          }
 114   1          else
 115   1          {
 116   2              return 0;
 117   2          }
 118   1      }
 119          
 120          
 121          /** This file contains system  function used for Motor Control.
 122           * @brief        1ã€Flashè‡ªçƒ§å†™: å¯¹æ‰‡åŒºé¢„ç¼–ç¨‹å’Œè‡ªæ“¦é™¤åï¼Œå¯ä»¥å¯¹æ‰‡åŒºå†…çš„åœ°å€è¿›è¡Œ
             -Flashçƒ§å†™ï¼Œ
 123                           2ã€ä¸€æ¬¡çƒ§å†™ä¸€ä¸ªbyte,ä¸€å®šè¦åœ¨è§£é”åæ‰ç»™DPTRèµ‹å€¼
 124           * @param[in]    FlashAddress: [è¾“å…¥] -- Flashçƒ§å†™åœ°å€
 125           * @param[in]    FlashData   : [è¾“å…¥] -- Flashçƒ§å†™æ•°æ®
 126           * @return       [è¾“å‡º] 0--Flashå†™æˆåŠŸï¼Œ1--Flashå†™å¤±è´¥
 127           */
 128          uint8 Flash_Sector_Write(uint8 xdata *FlashAddress, uint8 FlashData)
 129          {
 130   1          bool TempEA;
 131   1          uint16 TempFlashAddress;
 132   1          
 133   1          TempEA = EA;
 134   1          EA = 0;
 135   1          TempFlashAddress = FlashAddress;
 136   1      
 137   1          if(TempFlashAddress < 0x3f80)         // ä¸ç¼–ç¨‹æœ€åä¸€ä¸ªæ‰‡åŒº
 138   1          {
 139   2              FLA_CR = 0x01;              // ä½¿èƒ½Flashç¼–ç¨‹
 140   2              FLA_KEY = 0x5a;
 141   2              FLA_KEY = 0x1f;             // flashé¢„ç¼–ç¨‹è§£é”
 142   2              _nop_();
 143   2              *FlashAddress = FlashData;  // å†™ç¼–ç¨‹æ•°æ®
 144   2              FLA_CR = 0x08;              // å¼€å§‹é¢„ç¼–ç¨‹ï¼Œå®ŒæˆåFlashå†æ¬¡ä¸Šé”
 145   2          }
 146   1      
 147   1          EA = TempEA;
 148   1      
 149   1          if(ReadBit(FLA_CR, FLAERR))
 150   1          {
 151   2              return 1;
 152   2          }
 153   1          else
 154   1          {
 155   2              return 0;
 156   2          }
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    215    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
