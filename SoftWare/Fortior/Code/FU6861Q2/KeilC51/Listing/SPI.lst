C51 COMPILER V9.52.0.0   SPI                                                               04/01/2023 22:13:44 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN .\Output\SPI.obj
COMPILER INVOKED BY: D:\IDE\keil\C51\BIN\C51.EXE ..\User\Source\Hardware\SPI.c LARGE OMF2 WARNINGLEVEL(0) BROWSE INCDIR(
                    -..\User\Include;..\FU68xx_Hardware_Driver\Include) DEBUG PRINT(.\Listing\SPI.lst) TABS(2) OBJECT(.\Output\SPI.obj)

line level    source

   1          /**
   2           * @copyright (C) COPYRIGHT 2022 Fortiortech Shenzhen
   3           * @file      SPIInit.c
   4           * @author    Fortiortech  Appliction Team
   5           * @since     Create:2021-05-14
   6           * @date      Last modify:2022-07-14
   7           * @brief    This file contains SPI initial function used for Motor Control.
   8           */   
   9              
  10          #include <FU68xx_2.h>
  11          #include <Myproject.h>
  12          
  13          /**
  14           * @brief      SPIç›¸å…³å‚æ•°åˆå§‹åŒ–
  15           */
  16          void SPI_Init(void)
  17          {
  18   1          ClrBit(SPI_CR1, SPIEN);                                            // 0ï¼šdisable SPI; 1ï¼šenable
  19   1          /*  -------------------------------------------------------------------------------------------------
  20   1              SPIç®¡è„šé…ç½®
  21   1              1ã€ç¦æ­¢UARTå¤ç”¨ï¼ŒP06é…ç½®ä¸ºMISOï¼ŒP05é…ç½®ä¸ºMOSI
  22   1              2ã€ç¦æ­¢æ¯”è¾ƒå™¨è¾“å‡ºå¤ç”¨ï¼ŒP07é…ç½®ä¸ºSCLK
  23   1              -------------------------------------------------------------------------------------------------*
             -/
  24   1          ClrBit(PH_SEL, UARTEN);                                             // 0,P06 as GPIO or SPI_MISO,P05 a
             -s GPIO or SPI_MOSI;1,P06 and p07 as USART
  25   1          /*  -------------------------------------------------------------------------------------------------
  26   1              1ã€SPIæ—¶é’Ÿç›¸ä½/æžæ€§é…ç½®
  27   1              2ã€CPHA = 0, CPOL = 0:ä¸Šå‡æ²¿æŽ¥æ”¶ï¼Œä¸‹é™æ²¿å‘é€ï¼Œç©ºé—²ç”µå¹³ä¸ºä½Ž
  28   1              3ã€CPHA = 0, CPOL = 1:ä¸Šå‡æ²¿å‘é€ï¼Œä¸‹é™æ²¿æŽ¥æ”¶ï¼Œç©ºé—²ç”µå¹³ä¸ºé«˜
  29   1              4ã€CPHA = 1, CPOL = 0:ä¸Šå‡æ²¿å‘é€ï¼Œä¸‹é™æ²¿æŽ¥æ”¶ï¼Œç©ºé—²ç”µå¹³ä¸ºä½Ž
  30   1              5ã€CPHA = 1, CPOL = 1:ä¸Šå‡æ²¿æŽ¥æ”¶ï¼Œä¸‹é™æ²¿å‘é€ï¼Œç©ºé—²ç”µå¹³ä¸ºé«˜
  31   1              -------------------------------------------------------------------------------------------------*
             -/
  32   1          SetReg(SPI_CR0, CPHA | CPOL, CPOL);
  33   1          /*  -------------------------------------------------------------------------------------------------
  34   1              1ã€SPIä»Žæ–¹å¼é€‰æ‹©é…ç½®
  35   1              2ã€00ï¼š3çº¿ä»Žæ–¹å¼æˆ–3çº¿ä¸»æ–¹å¼ï¼ŒNSSä¿¡å·ä¸è¿žåˆ°ç«¯å£ç®¡è„š
  36   1              3ã€01ï¼š4çº¿ä»Žæ–¹å¼æˆ–4çº¿å¤šä¸»æ–¹å¼ï¼ŒNSSé…ç½®ä¸ºè¾“å…¥
  37   1              4ã€1xï¼š4çº¿å•ä¸»æ–¹å¼ï¼ŒNSSé…ç½®ä¸ºè¾“å‡ºï¼ŒNSSä¿¡å·è¾“å‡ºxç”µå¹³
  38   1              -------------------------------------------------------------------------------------------------*
             -/
  39   1      //    SetReg(SPI_CR1, NSSMOD0 | NSSMOD1, NSSMOD0 | NSSMOD1);//4çº¿æ¨¡æ‹Ÿ 
  40   1          SetReg(SPI_CR1, NSSMOD0 | NSSMOD1, NSSMOD0);//å•çº¿æ¨¡å¼ 
  41   1          SetBit(SPI_CR0, SPIMS);                                             // 0:Slave, 1:Master
  42   1          /*  -------------------------------------------------------------------------------------------------
  43   1              1ã€SPIä¸­æ–­é…ç½®
  44   1              2ã€SPIFï¼šSPIå­—èŠ‚ä¼ è¾“å®Œæˆä¸­æ–­æ ‡å¿—ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é›¶
  45   1              3ã€WCOLï¼šSPIå†™å†²çªä¸­æ–­ï¼ˆå‘é€ç¼“å†²å™¨éžç©ºæ—¶å†™æ“ä½œï¼‰ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é›¶
  46   1              4ã€MODFï¼šSPIæ–¹å¼é”™è¯¯ä¸­æ–­ï¼ˆå¤šä¸»æ–¹å¼NSSè¢«æ‹‰ä½Žï¼ŒMSTENå’ŒSPIENè¢«æ¸…é›¶ï¼‰ç¡¬ä»¶ç½®ä½
             -ï¼Œè½¯ä»¶æ¸…é›¶
  47   1              5ã€RXOVRNï¼šSPIæŽ¥æ”¶æº¢å‡ºä¸­æ–­ï¼ˆSPIæŽ¥æ”¶ç¼“å†²å™¨æŽ¥æ”¶æº¢å‡ºï¼‰ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é
             -›¶
  48   1              -------------------------------------------------------------------------------------------------*
C51 COMPILER V9.52.0.0   SPI                                                               04/01/2023 22:13:44 PAGE 2   

             -/
  49   1          SetReg(SPI_CR1, SPIIF | WCOL | MODF | RXOVR, 0x00);                 // SPIæ‰€æœ‰ä¸­æ–­æ¸…é™¤
  50   1          SPIIE = 0;                                                          // SPIä¸­æ–­ä½¿èƒ½
  51   1          SPI_CLK = 0;                                                        // Fspi = Fcpu / (2*(SPI_CLK + 1))
             - = 6MHz
  52   1          SetBit(SPI_CR1, SPIEN);                                             // enable SPI
  53   1      }
  54          
  55          
  56          /** 
  57           * @brief        SPIä¼ è¾“æ•°æ®
  58           * @param[in]    Data  ä¼ è¾“æ•°æ®ï¼Œuint16æ ¼å¼
  59           * @param[in]    Channel  ä¼ è¾“é€šé“ï¼Œå–å€¼0~3
  60           */
  61          void SPI_SendData(uint16 Data, uint8 Channel)
  62          {
  63   1          if (!ReadBit(SPI_CR0, SPIBSY))
  64   1          {
  65   2              Data = ((Data >> 4) + (0x1000));
  66   2              
  67   2              switch (Channel)
  68   2              {
  69   3                  case 0:
  70   3                      Data &= 0x3fff;
  71   3                      break;
  72   3                      
  73   3                  case 1:
  74   3                      Data |= 0x4000;
  75   3                      break;
  76   3                      
  77   3                  case 2:
  78   3                      Data |= 0x8000;
  79   3                      break;
  80   3                      
  81   3                  case 3:
  82   3                      Data |= 0xc000;
  83   3                      break;
  84   3                      
  85   3                  default:
  86   3                      break;
  87   3              }
  88   2              
  89   2              ClrBit(SPI_CR1, NSSMOD0);
  90   2              SPI_DR = Data >> 8;
  91   2              SPI_DR = Data;
  92   2              SetBit(SPI_CR1, NSSMOD0);
  93   2          }
  94   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    148    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
C51 COMPILER V9.52.0.0   SPI                                                               04/01/2023 22:13:44 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
