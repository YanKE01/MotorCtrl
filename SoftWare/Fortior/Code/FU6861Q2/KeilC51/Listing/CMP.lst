C51 COMPILER V9.52.0.0   CMP                                                               04/01/2023 22:13:43 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE CMP
OBJECT MODULE PLACED IN .\Output\CMP.obj
COMPILER INVOKED BY: D:\IDE\keil\C51\BIN\C51.EXE ..\User\Source\Hardware\CMP.c LARGE OMF2 WARNINGLEVEL(0) BROWSE INCDIR(
                    -..\User\Include;..\FU68xx_Hardware_Driver\Include) DEBUG PRINT(.\Listing\CMP.lst) TABS(2) OBJECT(.\Output\CMP.obj)

line level    source

   1          /**
   2           * @copyright (C) COPYRIGHT 2022 Fortiortech Shenzhen
   3           * @file      CMPInit.c
   4           * @author    Fortiortech  Appliction Team
   5           * @since     Create:2021-05-14
   6           * @date      Last modify:2022-07-14
   7           * @brief     This file contains CMP initial function used for Motor Control.
   8           */ 
   9           
  10          #include <FU68xx_2.h>
  11          #include <Myproject.h>
  12          
  13          
  14          /**
  15           * @brief      æ¯”è¾ƒå™¨3åˆå§‹åŒ–,ç”¨äºç¡¬ä»¶è¿‡æµä¿æŠ¤
  16           */
  17          void CMP3_Init(void)
  18          {
  19   1          #if (Shunt_Resistor_Mode == Single_Resistor)
  20   1          {
  21   2              SetBit(P2_AN, P27);                                         // CMP3
  22   2              SetReg(CMP_CR1, CMP3MOD1 | CMP3MOD0, 0x0);
  23   2          }
  24   1          #elif (Shunt_Resistor_Mode == Double_Resistor)
                  {
                      SetBit(P2_AN, P27);                                         // CMP3
                      SetReg(CMP_CR1, CMP3MOD1 | CMP3MOD0, 0x0);
                  }
                  #elif (Shunt_Resistor_Mode == Three_Resistor)
                  {
                      SetBit(P2_AN, P27 | P23 | P20);                             // CMP3
                      SetReg(CMP_CR1, CMP3MOD1 | CMP3MOD0, CMP3MOD1 | CMP3MOD0);
                  }
                  #endif  //end Shunt_Resistor_Mode
  35   1          #if (Compare_Mode == Compare_Hardware)
                  {
                      /* -----P2.6ä½¿èƒ½å…¶æ¨¡æ‹ŸåŠŸèƒ½ï¼Œä½¿èƒ½æ•°å­—è¾“å‡º----- */
                      SetBit(P2_AN, P26);
                      SetBit(P2_OE, P26);
                      ClrBit(DAC_CR, DACEN);
                  }
                  #else
  43   1          {
  44   2              /* -----ä½¿èƒ½DAC----- */
  45   2              SetBit(DAC_CR, DACEN );
  46   2              /*  ----------------------------------------------------------------------------------------------
             ----
  47   2                  1ã€DACç”µå‹æ¨¡å¼é…ç½®
  48   2                  2ã€0: æ­£å¸¸æ¨¡å¼ï¼ŒDACè¾“å‡ºç”µå‹èŒƒå›´ä¸º0åˆ°VREFï¼Œé€‚ç”¨äºç¡¬ä»¶è¿‡æµä¿æŠ¤
  49   2                  3ã€1: åŠç”µå‹è½¬æ¢æ¨¡å¼ï¼ŒDACè¾“å‡ºç”µå‹èŒƒå›´ä¸ºVHALFåˆ°VREF
  50   2                  ----------------------------------------------------------------------------------------------
             ----*/
  51   2              ClrBit(DAC_CR, DACMOD );
  52   2              //      SetBit(DAC_CR, DACMOD );
C51 COMPILER V9.52.0.0   CMP                                                               04/01/2023 22:13:43 PAGE 2   

  53   2          
  54   2              /* -----è®¾ç½®DACè¿‡æµå€¼----- */
  55   2              mcFaultDect.TempDACValue = DAC_OvercurrentValue;
  56   2          
  57   2              if (mcFaultDect.TempDACValue < 255)
  58   2              {
  59   3                  DAC_DR = mcFaultDect.TempDACValue;
  60   3              }
  61   2              else
  62   2              {
  63   3                  DAC_DR = 255;
  64   3              }
  65   2          }
  66   1          #endif  //end Compare_Mode
  67   1          SetBit(CMP_CR1, CMP3HYS);                                       // æ¯”è¾ƒå™¨3æœ‰è¿Ÿæ»ç”µå‹
  68   1          /*  -------------------------------------------------------------------------------------------------
  69   1              1ã€é€‰æ‹©æ¯çº¿ç”µæµä¿æŠ¤è§¦å‘ä¿¡å·æºï¼Œå¤–éƒ¨ä¸­æ–­0æˆ–è€…æ¯”è¾ƒå™¨3ä¸­æ–­ã€‚
  70   1              2ã€1-INT0, 0-CMP3
  71   1              -------------------------------------------------------------------------------------------------*
             -/
  72   1          ClrBit(EVT_FILT, EFSRC);
  73   1          /*  -------------------------------------------------------------------------------------------------
  74   1              1ã€è§¦å‘ç¡¬ä»¶ä¿æŠ¤åç¡¬ä»¶å…³é—­é©±åŠ¨è¾“å‡ºMOEé…ç½®
  75   1              2ã€00--MOEä¸è‡ªåŠ¨æ¸…é›¶
  76   1              3ã€01--MOEè‡ªåŠ¨æ¸…é›¶
  77   1              -------------------------------------------------------------------------------------------------*
             -/
  78   1          SetReg(EVT_FILT, MOEMD0 | MOEMD1, MOEMD0);
  79   1          //  SetReg(EVT_FILT, MOEMD0 | MOEMD1, 0x00);
  80   1          /*  -------------------------------------------------------------------------------------------------
  81   1              1ã€æ¯çº¿ç”µæµä¿æŠ¤æ—¶é—´æ»¤æ³¢å®½åº¦
  82   1              2ã€00-ä¸æ»¤æ³¢    01-4cpu clock    10-8cpu clock    11-16cpu clock
  83   1              -------------------------------------------------------------------------------------------------*
             -/
  84   1          SetReg(EVT_FILT, EFDIV0 | EFDIV1, EFDIV0 | EFDIV1);
  85   1          /*æ¯”è¾ƒå™¨ä½¿èƒ½-------------------------------------------------------------------------------------
             -*/
  86   1          SetBit(CMP_CR1, CMP3EN);
  87   1      }
  88          
  89          
  90          /**
  91           * @brief      æ¯”è¾ƒå™¨3ä¸­æ–­é…ç½®
  92           */
  93          void CMP3_Inter_Init(void)
  94          {
  95   1          /*  -------------------------------------------------------------------------------------------------
  96   1              1ã€æ¯”è¾ƒå™¨ä¸­æ–­æ¨¡å¼é…ç½®
  97   1              2ã€00: ä¸äº§ç”Ÿä¸­æ–­  01: ä¸Šå‡æ²¿äº§ç”Ÿä¸­æ–­  10: ä¸‹é™æ²¿äº§ç”Ÿä¸­æ–­  11: ä¸Šå‡/ä¸‹é™æ²
             -¿äº§ç”Ÿä¸­æ–­
  98   1              -------------------------------------------------------------------------------------------------*
             -/
  99   1          ClrBit(CMP_SR, CMP3IF);
 100   1          SetReg(CMP_CR0, CMP3IM1 | CMP3IM0, CMP3IM0);
 101   1          PCMP1 = 1;
 102   1          PCMP0 = 1;                                                      // ä¸­æ–­ä¼˜å…ˆçº§åˆ«3
 103   1          EA = 1;
 104   1      }
 105          


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.52.0.0   CMP                                                               04/01/2023 22:13:43 PAGE 3   

   CODE SIZE        =    101    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
