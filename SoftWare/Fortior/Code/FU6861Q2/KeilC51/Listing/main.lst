C51 COMPILER V9.52.0.0   MAIN                                                              04/01/2023 22:13:41 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Output\main.obj
COMPILER INVOKED BY: D:\IDE\keil\C51\BIN\C51.EXE ..\User\Source\Application\main.c LARGE OMF2 WARNINGLEVEL(0) BROWSE INC
                    -DIR(..\User\Include;..\FU68xx_Hardware_Driver\Include) DEBUG PRINT(.\Listing\main.lst) TABS(2) OBJECT(.\Output\main.obj)

line level    source

   1          /**
   2           * @copyright (C) COPYRIGHT 2022 Fortiortech Shenzhen
   3           * @file      main.c
   4           * @author    Fortiortech  Appliction Team
   5           * @since     Create:2021-05-14
   6           * @date      Last modify:2022-07-14
   7           * @brief     åŒ…å«ä¸»å‡½æ•°ï¼Œè½¯ç¡¬ä»¶åˆå§‹åŒ–å‡½æ•°ï¼ŒVRERé…ç½®å‡½æ•°,Debugå°å·¥å…·
   8           */
   9          
  10          #include <FU68xx_2.h>
  11          #include <Myproject.h>
  12          #include <SanityCheck.h>
  13          #include "TM1650.h"
  14          #include "MyVariable.h"
  15          /*  ------------------------------------------------------------------------------------
  16              Internal Routine Prototypes
  17              ------------------------------------------------------------------------------------ */
  18          void SoftwareInit(void);
  19          void HardwareInit(void);
  20          void DebugSet(void);
  21          void MotorControlInit(void);
  22          
  23          /**
  24           * @brief        ä¸»å‡½æ•°ä¸»è¦åŠŸèƒ½æ˜¯åˆå§‹åŒ–ï¼Œ
  25                               1ã€åŒ…æ‹¬ä¸Šç”µç­‰å¾…ï¼Œè½¯ä»¶åˆå§‹åŒ–ï¼Œç¡¬ä»¶åˆå§‹åŒ–ï¼Œè°ƒè¯•æ¨¡å¼è®¾ç½®ï¼Œä¸»
             -å¾ªç¯æ‰«æã€‚
  26                               2ã€è½¯ä»¶åˆå§‹åŒ–--åˆå§‹åŒ–æ‰€æœ‰å®šä¹‰çš„å˜é‡
  27                               3ã€ç¡¬ä»¶åˆå§‹åŒ–--åˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡é…ç½®
  28                               4ã€å¤§å¾ªç¯è¿è¡Œåç½®ç”µæµé‡‡é›†å‡½æ•°ï¼Œç”µæœºçŠ¶æ€æœºæ§åˆ¶å‡½æ•°ï¼Œä»¥åŠç¯
             -è·¯å“åº”å‡½æ•°
  29           */
  30          void main(void)
  31          {
  32   1          uint16 PowerUpCnt = 0;
  33   1          int i=0;
  34   1      
  35   1          /* -----ä¸Šç”µç­‰å¾…ç”µæºç¨³å®š ----- */
  36   1          for (PowerUpCnt = 0; PowerUpCnt < SystemPowerUpTime; PowerUpCnt++)
  37   1              ;
  38   1      
  39   1          /* -----è½¯ä»¶å‚æ•°åˆå§‹åŒ– ----- */
  40   1          SoftwareInit();
  41   1          /* -----ç¡¬ä»¶æ¨¡å—åˆå§‹åŒ–----- */
  42   1          HardwareInit();
  43   1          /* -----è°ƒè¯•æ¨¡å¼è®¾ç½®--å†…éƒ¨å˜é‡æŸ¥è¯¢ï¼›CMPè¾“å‡ºæŸ¥è¯¢ï¼›ADCè§¦å‘ä¿¡å·æŸ¥è¯¢----- */
  44   1          //DebugSet();
  45   1          TempPower = 0; // åŠŸç‡å€¼æ¸…é›¶
  46   1          MyVariableInit();
  47   1          SetBit(TIM234_CTRL, MDU_EN_N);
  48   1      
  49   1          while (1)
  50   1          {
  51   2      
  52   2              /* -----ç”µæµåç½®çš„è·å–----- */
C51 COMPILER V9.52.0.0   MAIN                                                              04/01/2023 22:13:41 PAGE 2   

  53   2              GetCurrentOffset();
  54   2              /* -----ä¸»æ§å‡½æ•°ï¼ŒçŠ¶æ€æ‰«æ 2.6k----- */
  55   2              MC_Control();
  56   2      
  57   2              if (VariableFlag.g_1msTick)
  58   2              {
  59   3                  TickCycle_1ms();
  60   3                  VariableFlag.g_1msTick = 0;
  61   3              }
  62   2      
  63   2              mcSpeedRamp.Value_UD = FOC__UD; //  FOC__ID  FOC__UD
  64   2              mcSpeedRamp.Value_UQ = FOC__UQ; //  FOC__IQ  FOC__UQ
  65   2              
  66   2      
  67   2          }
  68   1      }
  69          
  70          /**
  71           * @brief        SPI Debugè°ƒè¯•å°å·¥å…·
  72           */
  73          void DebugSet(void)
  74          {
  75   1      #if defined(SPI_DBG_HW) // ç¡¬ä»¶è°ƒè¯•æ¨¡å¼
                  Set_DBG_DMA(&HARD_SPIDATA);
              #elif defined(SPI_DBG_SW) // è½¯ä»¶è°ƒè¯•æ¨¡å¼
                  Set_DBG_DMA(spidebug);
              #endif
  80   1      #if defined(SPI_DBG_HW) && defined(SPI_DBG_SW)
              #error Only one DBG mode can be selected
              #endif
  83   1          /* -----Debugä¿¡å·é…ç½®----- */
  84   1          SetReg(CMP_CR3, DBGSEL0 | DBGSEL1, GP01_DBG_Conf);
  85   1          SetReg(CMP_CR3, CMPSEL0 | CMPSEL1 | CMPSEL2, GP07_DBG_Conf);
  86   1      }
  87          
  88          /**
  89           * @brief        è½¯ä»¶åˆå§‹åŒ–ï¼Œéƒ¨åˆ†å˜é‡åˆå§‹åŒ–ï¼Œä¸Šç”µè¿è¡Œä¸€æ¬¡
  90           */
  91          void SoftwareInit(void)
  92          {
  93   1          /* -----åˆå§‹åŒ–æ‰€æœ‰å®šä¹‰çš„å‚æ•°å˜é‡----- */
  94   1          MotorcontrolInit();
  95   1          /* -----ç”µæœºåˆå§‹çŠ¶æ€ä¸ºmcReadyï¼Œæ•…éšœä¿æŠ¤ä¸ºæ— æ•…éšœ----- */
  96   1          mcState = mcReady;
  97   1          mcFaultSource = 0;
  98   1      }
  99          
 100          /**
 101           * @brief     ç¡¬ä»¶åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–éœ€è¦ä½¿ç”¨çš„ç¡¬ä»¶è®¾å¤‡é…ç½®ï¼ŒFOCå¿…é¡»é…ç½®çš„æ˜¯è¿æ”¾ç”
             -µå‹ã€è¿æ”¾åˆå§‹åŒ–ã€ADCåˆå§‹åŒ–ã€Driveråˆå§‹åŒ–
 102           *            å…¶ä»–çš„å¯æ ¹æ®å®é™…éœ€æ±‚åŠ ã€‚
 103           */
 104          void HardwareInit(void)
 105          {
 106   1          /* -----ä¸ºæé«˜èŠ¯ç‰‡çš„æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œé™ä½èŠ¯ç‰‡åŠŸè€—ï¼Œè¯·åœ¨å…·ä½“é¡¹ç›®æ—¶ï¼Œå°†ä¸éœ€è¦ç
             -”¨çš„GPIOé»˜è®¤éƒ½é…ç½®ä¸ºè¾“å…¥ä¸Šæ‹‰----- */
 107   1          /* -----å…·ä½“é…ç½®å¯åœ¨GPIO_Default_Initè®¾ç½®----- */
 108   1          GPIO_Default_Init();
 109   1          /* -----æ¯”è¾ƒå™¨åˆå§‹åŒ–ï¼Œç”¨äºç¡¬ä»¶è¿‡æµæ¯”è¾ƒä¿æŠ¤----- */
 110   1          CMP3_Init();
 111   1          /* -----ä¼‘çœ æ¨¡å¼åˆå§‹åŒ–----- */
 112   1          //    Sleepmode_Init();
C51 COMPILER V9.52.0.0   MAIN                                                              04/01/2023 22:13:41 PAGE 3   

 113   1          /* -----åŠŸèƒ½IOåˆå§‹åŒ–----- */
 114   1          GPIO_Init();
 115   1          /* -----è¿ç®—æ”¾å¤§å™¨åˆå§‹åŒ–----- */
 116   1          AMP_Init();
 117   1          /* -----ADCåˆå§‹åŒ–----- */
 118   1          ADC_Init();
 119   1          /* -----æ¯”è¾ƒå™¨ä¸­æ–­é…ç½®----- */
 120   1          CMP3_Inter_Init(); // å»ºè®®å’Œæ¯”è¾ƒå™¨åˆå§‹åŒ–é—´éš”ä¸€æ®µæ—¶é—´
 121   1          /* -----Driveråˆå§‹åŒ–----- */
 122   1          Driver_Init();
 123   1      /* -----UARTåˆå§‹åŒ–----- */
 124   1      //    UART_Init();//æœªé…ç½®
 125   1      /* -----SPIè°ƒè¯•åˆå§‹åŒ–----- */
 126   1      #if defined(SPI_DBG_SW) | defined(SPI_DBG_HW) // è°ƒè¯•æ¨¡å¼
              //        SPI_Init();                                       //è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œå ç”¨SPIç«¯å£çš„NSS(GP04
             -),MOSI(GP05),SCK(GP06)
              #endif
 129   1      /* -----Timeråˆå§‹åŒ–----- */
 130   1      //    TIM2_Init();                                          //ç«¯å£GP07 & GP10
 131   1      #if (SPEED_MODE == PWMMODE)
                  TIM3_Init(); // ç«¯å£GP11,é‡‡æ ·å®šæ—¶å™¨3ä¸­æ–­ä½œä¸ºPWMæ•è·ä¸­æ–­
              #endif
 134   1      #if (FG_Enable == 1)
                  TIM4_Init(); // ç«¯å£GP01
              #endif
 137   1          TIM1ms_Init(); // é‡‡ç”¨1mså®šæ—¶å™¨ä¸­æ–­ä½œä¸ºå¸¸è§ä¸­æ–­,å¤„ç†æ•…éšœä¿æŠ¤ç­‰é™„åŠ åŠŸèƒ½
 138   1      
 139   1          /*-----TM1650åˆå§‹åŒ–----*/
 140   1          SetDisplay1650(7, 7, 1);
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
