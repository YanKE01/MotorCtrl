#ifndef SOURCE_MDS_MOTORCONTROL_H_
#define SOURCE_MDS_MOTORCONTROL_H_

#include "lcm32f037_lib.h"
#include "UserIncludes.h"


#if defined(EXPORT_MDS_MOTORCONTROL_H)
  #define EXTERN
#else
  #define EXTERN extern
#endif
	
#define MC_TRACK_TIME_MS 					(1000u)
#define MC_TRACK_TIME 						(u32)(MC_TRACK_TIME_MS * UPDS_CURR_FREQ / 1000)	
#define MC_TRACK_TIME_MS_FROM_IF 	(200u)
#define MC_TRACK_TIME_FROM_IF 		(u32)(MC_TRACK_TIME_MS_FROM_IF * UPDS_CURR_FREQ / 1000)		
	
#define MC_PRECHARGE_PWM 					(u16)((1.0-UPDS_PRECHARGE)*UP_PWM_PERIOD)	
#define MC_PRECHARGE_TIME   			(u32)(UPDS_PRECHARGE_TIME_MS*UPDS_CURR_FREQ/1000)
	
	
EXTERN void MDS_vMotorControlState(void);	
EXTERN u8 MDS_vIdle(void);
EXTERN u8 MDS_vInit(void);
EXTERN u8 MDS_vStop(void);
EXTERN u8 MDS_vStart(void);
EXTERN u8 MDS_vPrecharge(void);
EXTERN u8 MDS_vTrack(void);
EXTERN u8 MDS_vIdentify(void);	
EXTERN u8 MDS_vAlignment(void);
EXTERN u8 MDS_vOpenloop(void);
EXTERN u8 MDS_vClosedloop(void);
EXTERN u8 MDS_vBreak(void);
EXTERN u8 MDS_vFault(void);	
EXTERN u8 MDS_vWait(u32 WaitTime);
EXTERN u8 MDS_vWriteFlash(void);
EXTERN void MDS_vVSPCheck(void);
EXTERN void MDS_vPWMSwitchNextPeriod(void);
EXTERN void MDS_vPWMSwitchImmediate(void);
EXTERN void MDS_vMotorAppCommand(void);
EXTERN void MDS_vUdcSwitchCheck(void);
EXTERN void MDS_vFGRPM(void);
//static const s32 sqrt_table[512]=     
//{
//0, 
//741455, 
//1048576, 
//1284238, 
//1482910, 
//1657944, 
//1816187, 
//1961706, 
//2097152, 
//2224366, 
//2344687, 
//2459129, 
//2568476, 
//2673355, 
//2774271, 
//2871644,
//2965821, 
//3057098, 
//3145728, 
//3231928, 
//3315888, 
//3397775, 
//3477733, 
//3555894, 
//3632374, 
//3707276, 
//3780695, 
//3852714, 
//3923412, 
//3992858, 
//4061117, 
//4128248, 
//4194304, 
//4259336, 
//4323390, 
//4386508, 
//4448731, 
//4510096, 
//4570637, 
//4630386, 
//4689374, 
//4747630, 
//4805179, 
//4862047, 
//4918257, 
//4973833, 
//5028794, 
//5083161, 
//5136952, 
//5190186, 
//5242880, 
//5295049, 
//5346709, 
//5397875, 
//5448561, 
//5498779, 
//5548543, 
//5597864, 
//5646755, 
//5695225, 
//5743287, 
//5790950, 
//5838224, 
//5885118, 
//5931642, 
//5977803, 
//6023611, 
//6069072, 
//6114196, 
//6158989, 
//6203459, 
//6247613, 
//6291456, 
//6334996, 
//6378239, 
//6421190, 
//6463857, 
//6506243, 
//6548355, 
//6590198, 
//6631777, 
//6673097, 
//6714162, 
//6754978, 
//6795549, 
//6835879, 
//6875973, 
//6915834, 
//6955466, 
//6994874, 
//7034062, 
//7073032, 
//7111788, 
//7150335, 
//7188675, 
//7226811, 
//7264748, 
//7302487, 
//7340032, 
//7377386, 
//7414552, 
//7451533, 
//7488330, 
//7524948, 
//7561389, 
//7597655, 
//7633749, 
//7669672, 
//7705428, 
//7741020, 
//7776448, 
//7811715, 
//7846824, 
//7881777, 
//7916575, 
//7951221, 
//7985717, 
//8020064, 
//8054265, 
//8088321, 
//8122235, 
//8156007, 
//8189640, 
//8223136, 
//8256496, 
//8289721, 
//8322814, 
//8355776, 
//8388608, 
//8421312, 
//8453890, 
//8486343, 
//8518672, 
//8550879,
//8582964, 
//8614931, 
//8646779,
//8678511, 
//8710126, 
//8741628, 
//8773016, 
//8804293, 
//8835458, 
//8866515, 
//8897462, 
//8928303, 
//8959037, 
//8989667, 
//9020192, 
//9050614, 
//9080935, 
//9111154, 
//9141274, 
//9171294, 
//9201217, 
//9231043, 
//9260772, 
//9290407, 
//9319947, 
//9349394, 
//9378749, 
//9408012, 
//9437184, 
//9466266, 
//9495260, 
//9524164, 
//9552982, 
//9581713, 
//9610358, 
//9638918, 
//9667393, 
//9695785, 
//9724094, 
//9752321, 
//9780466, 
//9808530, 
//9836515, 
//9864420, 
//9892246, 
//9919994, 
//9947665, 
//9975260, 
//10002778, 
//10030220, 
//10057588, 
//10084881, 
//10112101, 
//10139247, 
//10166322, 
//10193324, 
//10220255, 
//10247115, 
//10273905, 
//10300625, 
//10327276, 
//10353858, 
//10380373, 
//10406820, 
//10433199, 
//10459513, 
//10485760, 
//10511942, 
//10538058, 
//10564110, 
//10590098, 
//10616023, 
//10641884, 
//10667683, 
//10693419, 
//10719093, 
//10744707, 
//10770259, 
//10795751, 
//10821182, 
//10846554, 
//10871867, 
//10897121, 
//10922317, 
//10947455, 
//10972535, 
//10997558, 
//11022524, 
//11047434, 
//11072287, 
//11097085, 
//11121828, 
//11146516, 
//11171149, 
//11195728, 
//11220253, 
//11244725, 
//11269143, 
//11293509, 
//11317822, 
//11342084, 
//11366293, 
//11390451, 
//11414558, 
//11438614, 
//11462619, 
//11486575, 
//11510480, 
//11534336, 
//11558143, 
//11581900, 
//11605610, 
//11629270, 
//11652883, 
//11676448, 
//11699966, 
//11723436, 
//11746860, 
//11770236, 
//11793567, 
//11816851, 
//11840090, 
//11863283, 
//11886431, 
//11909534, 
//11932592, 
//11955606, 
//11978575, 
//12001501, 
//12024383, 
//12047221, 
//12070016, 
//12092768, 
//12115478, 
//12138145, 
//12160769, 
//12183352, 
//12205893, 
//12228392, 
//12250850, 
//12273267, 
//12295643, 
//12317979, 
//12340274, 
//12362529, 
//12384744, 
//12406919, 
//12429054, 
//12451150, 
//12473207, 
//12495225, 
//12517204, 
//12539145, 
//12561048, 
//12582912, 
//12604738, 
//12626527, 
//12648278, 
//12669992,
//12691669, 
//12713308, 
//12734911, 
//12756478, 
//12778008 ,
//12799501 ,
//12820959 ,
//12842381 ,
//12863767 ,
//12885118 ,
//12906433 ,
//12927713 ,
//12948958 ,
//12970169 ,
//12991345 ,
//13012486 ,
//13033593 ,
//13054666 ,
//13075705 ,
//13096710 ,
//13117682 ,
//13138620 ,
//13159524 ,
//13180396 ,
//13201235 ,
//13222040 ,
//13242813 ,
//13263554 ,
//13284262 ,
//13304938 ,
//13325582 ,
//13346194 ,
//13366774 ,
//13387322 ,
//13407839 ,
//13428325 ,
//13448779 ,
//13469203 ,
//13489595 ,
//13509957 ,
//13530288 ,
//13550588 ,
//13570858 ,
//13591098 ,
//13611308 ,
//13631488 ,
//13651638 ,
//13671758 ,
//13691849 ,
//13711910 ,
//13731942 ,
//13751945 ,
//13771919 ,
//13791864 ,
//13811780 ,
//13831667 ,
//13851526 ,
//13871357 ,
//13891159 ,
//13910933 ,
//13930678 ,
//13950396 ,
//13970086 ,
//13989749 ,
//14009383 ,
//14028991 ,
//14048571 ,
//14068123 ,
//14087649 ,
//14107147 ,
//14126619 ,
//14146064 ,
//14165482 ,
//14184873 ,
//14204238 ,
//14223577 ,
//14242889 ,
//14262176 ,
//14281436 ,
//14300670 ,
//14319878 ,
//14339061 ,
//14358218 ,
//14377350 ,
//14396456 ,
//14415537 ,
//14434592 ,
//14453623 ,
//14472628 ,
//14491609 ,
//14510564 ,
//14529495 ,
//14548402 ,
//14567283 ,
//14586141 ,
//14604974 ,
//14623782 ,
//14642567 ,
//14661327 ,
//14680064 ,
//14698777 ,
//14717465 ,
//14736131 ,
//14754772 ,
//14773390 ,
//14791985 ,
//14810556 ,
//14829104 ,
//14847629 ,
//14866131 ,
//14884609 ,
//14903065 ,
//14921498 ,
//14939908 ,
//14958296 ,
//14976661 ,
//14995003 ,
//15013324 ,
//15031621 ,
//15049897 ,
//15068150 ,
//15086382 ,
//15104591 ,
//15122778 ,
//15140944 ,
//15159087 ,
//15177209 ,
//15195310 ,
//15213389 ,
//15231446 ,
//15249482 ,
//15267497 ,
//15285491 ,
//15303463 ,
//15321414 ,
//15339344 ,
//15357254 ,
//15375142 ,
//15393010 ,
//15410857 ,
//15428683 ,
//15446489 ,
//15464274 ,
//15482039 ,
//15499784 ,
//15517508 ,
//15535212 ,
//15552895 ,
//15570559 ,
//15588203 ,
//15605827 ,
//15623431 ,
//15641015 ,
//15658579 ,
//15676124 ,
//15693649 ,
//15711154 ,
//15728640 ,
//15746107 ,
//15763554 ,
//15780982 ,
//15798390 ,
//15815780 ,
//15833150 ,
//15850502 ,
//15867834 ,
//15885148 ,
//15902442 ,
//15919718 ,
//15936975 ,
//15954214 ,
//15971434 ,
//15988635 ,
//16005818 ,
//16022982 ,
//16040128 ,
//16057256 ,
//16074366 ,
//16091457 ,
//16108530 ,
//16125585 ,
//16142622 ,
//16159641 ,
//16176643 ,
//16193626 ,
//16210592 ,
//16227539 ,
//16244470 ,
//16261382 ,
//16278277 ,
//16295154 ,
//16312014 ,
//16328857 ,
//16345682 ,
//16362490 ,
//16379281 ,
//16396054 ,
//16412811 ,
//16429550 ,
//16446272 ,
//16462977 ,
//16479665 ,
//16496337 ,
//16512991 ,
//16529629 ,
//16546250 ,
//16562855 ,
//16579442 ,
//16596013 ,
//16612568 ,
//16629106 ,
//16645628 ,
//16662133 ,
//16678622 ,
//16695095 ,
//16711551 ,
//16727992 ,
//16744416 ,
//16760824 ,
//};
static const s16 sqrt_table[512]={
0 ,
1448 ,
2048 ,
2508 ,
2896 ,
3238 ,
3547 ,
3831 ,
4096 ,
4344 ,
4579 ,
4803 ,
5017 ,
5221 ,
5418 ,
5609 ,
5793 ,
5971 ,
6144 ,
6312 ,
6476 ,
6636 ,
6792 ,
6945 ,
7094 ,
7241 ,
7384 ,
7525 ,
7663 ,
7799 ,
7932 ,
8063 ,
8192 ,
8319 ,
8444 ,
8567 ,
8689 ,
8809 ,
8927 ,
9044 ,
9159 ,
9273 ,
9385 ,
9496 ,
9606 ,
9715 ,
9822 ,
9928 ,
10033 ,
10137 ,
10240 ,
10342 ,
10443 ,
10543 ,
10642 ,
10740 ,
10837 ,
10933 ,
11029 ,
11123 ,
11217 ,
11310 ,
11403 ,
11494 ,
11585 ,
11675 ,
11765 ,
11854 ,
11942 ,
12029 ,
12116 ,
12202 ,
12288 ,
12373 ,
12457 ,
12541 ,
12625 ,
12708 ,
12790 ,
12871 ,
12953 ,
13033 ,
13114 ,
13193 ,
13273 ,
13351 ,
13430 ,
13507 ,
13585 ,
13662 ,
13738 ,
13815 ,
13890 ,
13965 ,
14040 ,
14115 ,
14189 ,
14263 ,
14336 ,
14409 ,
14482 ,
14554 ,
14626 ,
14697 ,
14768 ,
14839 ,
14910 ,
14980 ,
15050 ,
15119 ,
15188 ,
15257 ,
15326 ,
15394 ,
15462 ,
15530 ,
15597 ,
15664 ,
15731 ,
15798 ,
15864 ,
15930 ,
15995 ,
16061 ,
16126 ,
16191 ,
16255 ,
16320 ,
16384 ,
16448 ,
16512 ,
16575 ,
16638 ,
16701 ,
16764 ,
16826 ,
16888 ,
16950 ,
17012 ,
17073 ,
17135 ,
17196 ,
17257 ,
17317 ,
17378 ,
17438 ,
17498 ,
17558 ,
17618 ,
17677 ,
17736 ,
17795 ,
17854 ,
17913 ,
17971 ,
18029 ,
18087 ,
18145 ,
18203 ,
18261 ,
18318 ,
18375 ,
18432 ,
18489 ,
18545 ,
18602 ,
18658 ,
18714 ,
18770 ,
18826 ,
18882 ,
18937 ,
18992 ,
19048 ,
19102 ,
19157 ,
19212 ,
19266 ,
19321 ,
19375 ,
19429 ,
19483 ,
19537 ,
19590 ,
19644 ,
19697 ,
19750 ,
19803 ,
19856 ,
19909 ,
19961 ,
20014 ,
20066 ,
20118 ,
20170 ,
20222 ,
20274 ,
20326 ,
20377 ,
20429 ,
20480 ,
20531 ,
20582 ,
20633 ,
20684 ,
20734 ,
20785 ,
20835 ,
20886 ,
20936 ,
20986 ,
21036 ,
21085 ,
21135 ,
21185 ,
21234 ,
21283 ,
21333 ,
21382 ,
21431 ,
21480 ,
21528 ,
21577 ,
21626 ,
21674 ,
21722 ,
21771 ,
21819 ,
21867 ,
21915 ,
21962 ,
22010 ,
22058 ,
22105 ,
22153 ,
22200 ,
22247 ,
22294 ,
22341 ,
22388 ,
22435 ,
22481 ,
22528 ,
22574 ,
22621 ,
22667 ,
22713 ,
22760 ,
22806 ,
22851 ,
22897 ,
22943 ,
22989 ,
23034 ,
23080 ,
23125 ,
23170 ,
23216 ,
23261 ,
23306 ,
23351 ,
23396 ,
23440 ,
23485 ,
23530 ,
23574 ,
23619 ,
23663 ,
23707 ,
23752 ,
23796 ,
23840 ,
23884 ,
23927 ,
23971 ,
24015 ,
24059 ,
24102 ,
24146 ,
24189 ,
24232 ,
24275 ,
24319 ,
24362 ,
24405 ,
24448 ,
24491 ,
24533 ,
24576 ,
24619 ,
24661 ,
24704 ,
24746 ,
24788 ,
24831 ,
24873 ,
24915 ,
24957 ,
24999 ,
25041 ,
25083 ,
25125 ,
25166 ,
25208 ,
25249 ,
25291 ,
25332 ,
25374 ,
25415 ,
25456 ,
25497 ,
25538 ,
25580 ,
25620 ,
25661 ,
25702 ,
25743 ,
25784 ,
25824 ,
25865 ,
25905 ,
25946 ,
25986 ,
26027 ,
26067 ,
26107 ,
26147 ,
26187 ,
26227 ,
26267 ,
26307 ,
26347 ,
26387 ,
26426 ,
26466 ,
26506 ,
26545 ,
26585 ,
26624 ,
26663 ,
26703 ,
26742 ,
26781 ,
26820 ,
26859 ,
26898 ,
26937 ,
26976 ,
27015 ,
27054 ,
27092 ,
27131 ,
27170 ,
27208 ,
27247 ,
27285 ,
27324 ,
27362 ,
27400 ,
27439 ,
27477 ,
27515 ,
27553 ,
27591 ,
27629 ,
27667 ,
27705 ,
27743 ,
27780 ,
27818 ,
27856 ,
27893 ,
27931 ,
27969 ,
28006 ,
28043 ,
28081 ,
28118 ,
28155 ,
28193 ,
28230 ,
28267 ,
28304 ,
28341 ,
28378 ,
28415 ,
28452 ,
28489 ,
28525 ,
28562 ,
28599 ,
28635 ,
28672 ,
28709 ,
28745 ,
28782 ,
28818 ,
28854 ,
28891 ,
28927 ,
28963 ,
28999 ,
29035 ,
29072 ,
29108 ,
29144 ,
29180 ,
29215 ,
29251 ,
29287 ,
29323 ,
29359 ,
29394 ,
29430 ,
29466 ,
29501 ,
29537 ,
29572 ,
29608 ,
29643 ,
29678 ,
29714 ,
29749 ,
29784 ,
29819 ,
29854 ,
29890 ,
29925 ,
29960 ,
29995 ,
30030 ,
30064 ,
30099 ,
30134 ,
30169 ,
30204 ,
30238 ,
30273 ,
30308 ,
30342 ,
30377 ,
30411 ,
30446 ,
30480 ,
30515 ,
30549 ,
30583 ,
30617 ,
30652 ,
30686 ,
30720 ,
30754 ,
30788 ,
30822 ,
30856 ,
30890 ,
30924 ,
30958 ,
30992 ,
31026 ,
31059 ,
31093 ,
31127 ,
31161 ,
31194 ,
31228 ,
31261 ,
31295 ,
31328 ,
31362 ,
31395 ,
31429 ,
31462 ,
31495 ,
31529 ,
31562 ,
31595 ,
31628 ,
31661 ,
31694 ,
31727 ,
31761 ,
31794 ,
31826 ,
31859 ,
31892 ,
31925 ,
31958 ,
31991 ,
32024 ,
32056 ,
32089 ,
32122 ,
32154 ,
32187 ,
32219 ,
32252 ,
32284 ,
32317 ,
32349 ,
32382 ,
32414 ,
32446 ,
32479 ,
32511 ,
32543 ,
32575 ,
32608 ,
32640 ,
32672, 
32704, 
32736, 
};

#undef EXTERN
#endif
	